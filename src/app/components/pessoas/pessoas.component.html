<div class="container mt-4">
  <h2>Cadastro de Pessoas</h2>

  <button class="btn btn-primary mb-3" (click)="novaPessoa()">Nova Pessoa</button>

  <!-- Tabela de Pessoas (PrimeNG) -->
  <p-table [value]="pessoas" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
           currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros" [rowsPerPageOptions]="[10,25,50]">
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Nome</th>
        <th>CPF</th>
        <th>Email</th>
        <th>Celular</th>
        <th>Ativo</th>
        <th>Ações</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-pessoa>
      <tr>
        <td>{{ pessoa.id }}</td>
        <td>{{ pessoa.nome }}</td>
        <td>{{ pessoa.cpf }}</td>
        <td>{{ pessoa.email }}</td>
        <td>{{ pessoa.celular }}</td>
        <td>{{ pessoa.ativo ? 'Sim' : 'Não' }}</td>
        <td>
          <button pButton type="button" icon="pi pi-pencil" class="p-button-rounded p-button-warning me-2" (click)="selecionarPessoa(pessoa)"></button>
          <button pButton type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger" (click)="excluirPessoa(pessoa.id)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Diálogo para Adicionar/Editar Pessoa (PrimeNG) -->
  <p-dialog [(visible)]="mostrarFormulario" [modal]="true" [style]="{width: '50vw'}" [header]="modoEdicao ? 'Editar Pessoa' : 'Adicionar Nova Pessoa'">
    <ng-template pTemplate="content">
      <form (ngSubmit)="salvarPessoa()">
        <div class="p-fluid">
          <div class="p-field mb-3">
            <label for="nome">Nome Completo</label>
            <input id="nome" type="text" pInputText [(ngModel)]="pessoaForm.nome" name="nome" required>
          </div>
          <div class="p-field mb-3">
            <label for="email">Email</label>
            <input id="email" type="email" pInputText [(ngModel)]="pessoaForm.email" name="email" required>
          </div>

          <div class="p-field mb-3">
            <label for="cpf">CPF</label>
            <input id="cpf" type="text" pInputText [(ngModel)]="pessoaForm.cpf" name="cpf" required>
          </div>
          <div class="p-field mb-3">
            <label for="rg">RG</label>
            <input id="rg" type="text" pInputText [(ngModel)]="pessoaForm.rg" name="rg">
          </div>
          <div class="p-field mb-3">
            <label for="celular">Celular</label>
            <input id="celular" type="text" pInputText [(ngModel)]="pessoaForm.celular" name="celular" required>
          </div>

          <div class="p-field mb-3">
            <label for="dataNascimento">Data de Nascimento</label>
            <!-- Usando input type="date" nativo por simplicidade, p-calendar seria outra opção -->
            <input id="dataNascimento" type="date" pInputText [(ngModel)]="pessoaForm.dataNascimento" name="dataNascimento" required>
          </div>

          <div class="p-field-checkbox mb-3">
            <p-checkbox id="ativo" [(ngModel)]="pessoaForm.ativo" name="ativo" [binary]="true"></p-checkbox>
            <label for="ativo">Ativo</label>
          </div>

          <hr>
          <h5>Endereço</h5>
          <div class="p-field mb-3">
            <label for="logradouro">Logradouro</label>
            <input id="logradouro" type="text" pInputText [(ngModel)]="pessoaForm.endereco.logradouro" name="logradouro" required>
          </div>
          <div class="p-field mb-3">
            <label for="numero">Número</label>
            <input id="numero" type="text" pInputText [(ngModel)]="pessoaForm.endereco.numero" name="numero" required>
          </div>
          <div class="p-field mb-3">
            <label for="complemento">Complemento</label>
            <input id="complemento" type="text" pInputText [(ngModel)]="pessoaForm.endereco.complemento" name="complemento">
          </div>
          <div class="p-field mb-3">
            <label for="bairro">Bairro</label>
            <input id="bairro" type="text" pInputText [(ngModel)]="pessoaForm.endereco.bairro" name="bairro" required>
          </div>
          <div class="p-field mb-3">
            <label for="cep">CEP</label>
            <input id="cep" type="text" pInputText [(ngModel)]="pessoaForm.endereco.cep" name="cep" required>
          </div>
          <div class="p-field mb-3">
            <label for="cidade">Cidade</label>
            <input id="cidade" type="text" pInputText [(ngModel)]="pessoaForm.endereco.cidade" name="cidade" required>
          </div>
          <div class="p-field mb-3">
            <label for="estado">Estado</label>
            <input id="estado" type="text" pInputText [(ngModel)]="pessoaForm.endereco.estado" name="estado" required>
          </div>
        </div>
      </form>
    </ng-template>

    <ng-template pTemplate="footer">
      <button pButton type="button" label="Cancelar" icon="pi pi-times" class="p-button-secondary" (click)="cancelarFormulario()"></button>
      <button pButton type="submit" label="{{ modoEdicao ? 'Atualizar' : 'Salvar' }}" icon="pi pi-check" class="p-button-success" (click)="salvarPessoa()"></button>
    </ng-template>
  </p-dialog>
</div>
